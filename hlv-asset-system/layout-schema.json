{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "HLV Layout Schema",
  "description": "Schema for HLV diagram layout definitions",
  "type": "object",
  "required": ["id", "name", "canvas", "nodes"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier (kebab-case)",
      "pattern": "^[a-z0-9-]+$"
    },
    "name": {
      "type": "string",
      "description": "Human-readable name"
    },
    "description": {
      "type": "string",
      "description": "What this diagram teaches or communicates"
    },
    "canvas": {
      "type": "string",
      "enum": ["standard", "square"],
      "description": "Canvas size preset from tokens"
    },
    "annotations": {
      "type": "object",
      "properties": {
        "title": {
          "type": "object",
          "properties": {
            "text": { "type": "string" },
            "style": { "type": "string", "default": "title" }
          },
          "required": ["text"]
        },
        "subtitle": {
          "type": "object",
          "properties": {
            "text": { "type": "string" },
            "style": { "type": "string", "default": "subtitle" }
          },
          "required": ["text"]
        },
        "caption": {
          "type": "object",
          "properties": {
            "text": { "type": "string" },
            "style": { "type": "string", "default": "caption" }
          },
          "required": ["text"]
        },
        "legend": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "color": { "type": "string" },
              "shape": { "type": "string", "enum": ["circle", "square", "triangle", "line"] },
              "label": { "type": "string" }
            },
            "required": ["label"]
          }
        }
      }
    },
    "nodes": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "type", "grid"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique node identifier"
          },
          "type": {
            "type": "string",
            "enum": [
              "box", "boxNavy", "boxAccent", "boxWarm",
              "circle", "circleAccent",
              "phase", "phaseAccent",
              "diamond",
              "card", "cardHeader", "cardHeaderAccent", "cardHighlight", "cardWarm",
              "label",
              "icon",
              "group"
            ],
            "description": "Node type from components.nodes or components.cards"
          },
          "label": {
            "type": "string",
            "description": "Primary text content"
          },
          "sublabel": {
            "type": "string",
            "description": "Secondary text content"
          },
          "textStyle": {
            "type": "string",
            "description": "Override default text style from textStyles"
          },
          "grid": {
            "type": "object",
            "required": ["col", "row"],
            "properties": {
              "col": {
                "type": "number",
                "minimum": 1,
                "maximum": 12,
                "description": "Starting column (1-indexed)"
              },
              "row": {
                "type": "number",
                "minimum": 1,
                "maximum": 6,
                "description": "Starting row (1-indexed)"
              },
              "colSpan": {
                "type": "number",
                "minimum": 1,
                "default": 1,
                "description": "Number of columns to span"
              },
              "rowSpan": {
                "type": "number",
                "minimum": 1,
                "default": 1,
                "description": "Number of rows to span"
              },
              "align": {
                "type": "string",
                "enum": ["start", "center", "end"],
                "default": "center",
                "description": "Horizontal alignment within grid cell"
              },
              "valign": {
                "type": "string",
                "enum": ["start", "center", "end"],
                "default": "center",
                "description": "Vertical alignment within grid cell"
              },
              "offsetX": {
                "type": "number",
                "default": 0,
                "description": "Pixel offset from calculated grid position"
              },
              "offsetY": {
                "type": "number",
                "default": 0,
                "description": "Pixel offset from calculated grid position"
              }
            }
          },
          "size": {
            "type": "object",
            "properties": {
              "width": { 
                "type": ["number", "string"],
                "description": "Explicit width in pixels or 'auto'"
              },
              "height": { 
                "type": ["number", "string"],
                "description": "Explicit height in pixels or 'auto'"
              }
            },
            "description": "Explicit size overrides grid-based sizing"
          },
          "style": {
            "type": "object",
            "description": "Style overrides for this specific node",
            "properties": {
              "fill": { "type": "string" },
              "stroke": { "type": "string" },
              "strokeWidth": { "type": "string" },
              "radius": { "type": "string" },
              "opacity": { "type": "number" }
            }
          },
          "children": {
            "type": "array",
            "items": { "$ref": "#/properties/nodes/items" },
            "description": "Nested nodes for groups and cards with content"
          },
          "data": {
            "type": "object",
            "description": "Custom data for complex nodes (e.g., list items, table data)"
          }
        }
      }
    },
    "edges": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["from", "to"],
        "properties": {
          "id": {
            "type": "string",
            "description": "Optional edge identifier"
          },
          "from": {
            "type": "string",
            "description": "Source node ID"
          },
          "to": {
            "type": "string",
            "description": "Target node ID"
          },
          "type": {
            "type": "string",
            "enum": ["arrow", "arrowAccent", "arrowMuted", "line", "dashed", "curved"],
            "default": "arrow",
            "description": "Edge type from components.edges"
          },
          "fromAnchor": {
            "type": "string",
            "enum": ["top", "right", "bottom", "left", "center"],
            "default": "right",
            "description": "Connection point on source node"
          },
          "toAnchor": {
            "type": "string",
            "enum": ["top", "right", "bottom", "left", "center"],
            "default": "left",
            "description": "Connection point on target node"
          },
          "label": {
            "type": "string",
            "description": "Optional label displayed on edge"
          },
          "labelPosition": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "default": 0.5,
            "description": "Position of label along edge (0 = start, 1 = end)"
          },
          "style": {
            "type": "object",
            "description": "Style overrides for this specific edge"
          }
        }
      }
    },
    "shapes": {
      "type": "array",
      "description": "Custom shapes not covered by standard nodes",
      "items": {
        "type": "object",
        "required": ["id", "type"],
        "properties": {
          "id": { 
            "type": "string",
            "description": "Unique shape identifier"
          },
          "type": { 
            "type": "string",
            "enum": ["polygon", "path", "rect", "ellipse", "line"],
            "description": "SVG shape type"
          },
          "points": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "col": { "type": "number" },
                "row": { "type": "number" },
                "x": { "type": "number" },
                "y": { "type": "number" }
              },
              "description": "Use col/row for grid-based or x/y for absolute positioning"
            },
            "description": "Points for polygon or line shapes"
          },
          "d": {
            "type": "string",
            "description": "SVG path data for path type"
          },
          "style": {
            "type": "object",
            "properties": {
              "fill": { "type": "string" },
              "stroke": { "type": "string" },
              "strokeWidth": { "type": "string" },
              "opacity": { "type": "number" },
              "dashArray": { "type": "string" }
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "category": {
          "type": "string",
          "enum": ["framework", "process", "comparison", "concept", "matrix", "cycle", "hierarchy", "template"],
          "description": "Diagram archetype"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Searchable tags"
        },
        "source": {
          "type": "string",
          "description": "Attribution if based on external framework"
        },
        "usage": {
          "type": "string",
          "description": "When and how to use this diagram in curriculum"
        },
        "relatedTo": {
          "type": "array",
          "items": { "type": "string" },
          "description": "IDs of related diagrams"
        }
      }
    }
  }
}
